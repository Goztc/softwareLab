# Lab4 OO分析与设计

## 2. 用例模型

### 2.3 上传文档的事件流描述

本用例所涉及的actor(s)：知识管理用户，RAG智能问答系统，外部云存储服务
常规事件流
（1）知识管理用户登录系统后，进入文档管理界面，点击“上传文档”按钮。
（2）系统显示上传界面，支持用户选择多格式文档（如PDF、DOCX、TXT）。
（3）知识管理用户选择一个或多个文档，点击“确认上传”。
（4）用户可选在线编辑文档并保存为“.txt”格式文档上传。
（5）系统验证文档格式和大小，上传成功后显示文档列表，更新文件夹视图。
（6）知识管理用户选择退出上传界面。
备选事件流：
（7）在步骤3，4中，用户可选将文档同步至外部云存储服务，点击“同步”按钮。
（8）在步骤7中，系统调用外部云存储服务API，完成文档备份，显示同步成功提示。
（9）在步骤3中，若用户上传的文档格式不受支持，系统提示“格式不支持，请选择PDF、DOCX或TXT文件”。
（10）在步骤7中，若外部云存储服务不可用，系统提示“云存储服务连接失败，请稍后重试”。
	前提条件：用例开始前，知识管理用户须在系统登录成功，且具有文档上传权限。
	后置条件：若用例执行成功，文档上传至系统并显示在文档列表中；若选择同步，文档备份至云存储。否则，文档列表保持不变。

### 2.4 提交问题并查看回答的事件流描述

本用例所涉及的actor(s)：知识管理用户，RAG智能问答系统
常规事件流
（1）知识管理用户登录系统后，进入问答界面，输入自然语言问题。
（2）系统基于RAG技术，从指定文档中检索相关内容，生成智能回答。
（3）系统显示回答内容，并列出引用来源（如文档名称和段落）。
（4）知识管理用户查看回答及引用，可选择继续提问或结束会话。
（5）系统保存会话记录，用户可随时查看历史问答。
备选事件流
（6）在步骤1中，用户可选指定文档或文件夹作为回答范围，点击“提交”。
（7）在步骤2中，若无相关文档，系统提示“未找到相关内容，请检查问题或上传更多文档”。
	前提条件：用例开始前，知识管理用户须登录成功，且至少有一个可用的文档。
	后置条件：若用例执行成功，用户获得智能回答及引用来源，会话记录更新。否则，系统提示无结果，会话记录保持不变。


### 2.5 管理会话的事件流描述

本用例所涉及的actor(s)：知识管理用户，RAG智能问答系统
常规事件流：
（1）知识管理用户登录系统后，进入会话管理界面，点击“查看会话历史”。
（2）系统按时间分类显示会话列表：最近一天、最近五天、更早。
（3）用户可继续该会话，输入新问题，系统基于RAG技术生成回答并显示引用来源。
（4）系统保存新问题和回答，更新会话记录并归类到“最近一天”。
（5）用户可删除某会话，点击“删除”并确认，系统移除该会话并更新列表。
（6）用户选择退出会话管理界面。
备选事件流：
（7）在步骤2中，列表包含会话时间、问题摘要和关联文档。
（8）在步骤2中，若无会话记录，系统提示“暂无会话记录，请提交问题开始新会话”。
	前提条件：知识管理用户须登录成功，且系统时钟基于2025年6月10日22:01 HKT以支持时间分类。
	后置条件：若用例执行成功，用户查看或更新会话记录，按时间分类（最近一天、最近五天、更早）更新列表，删除操作反映在列表中。否则，会话列表保持不变。

## 3. 类识别

### 3.1 边界类

### 3.1 边界类

| 类名（中文） | 类名（英文） | 类的作用概述 |
|------------|------------|------------|
| 登录注册界面 | UserLoginInterface | 用户进行登录和注册的操作界面，提供用户名、密码输入字段，验证身份后进入系统或完成注册流程。 |
| 主页界面 | SystemMainInterface | 系统主页面，提供导航功能、主题切换、用户下拉菜单等整体界面框架和交互控制。 |
| 用户信息界面 | UserInfoManagementInterface | 用户查看和更新个人信息（包括用户名、手机号、邮箱、头像等）的界面，支持保存修改和密码变更。 |
| 文档管理界面 | DocumentManagementInterface | 用户进行文件和文件夹管理的界面，支持文件上传、下载、删除、重命名，文件夹创建和组织等操作。 |
| 智能问答界面 | IntelligentQAInterface | 用户与RAG系统进行智能对话的界面，支持输入问题、查看回答、显示引用来源、管理会话历史。 |

### 3.2 控制类

| 类名（中文） | 类名（英文） | 类的作用概述 |
|------------|------------|------------|
| 用户服务 | UserService | 处理用户注册、登录验证、个人信息更新、头像修改、密码变更等用户管理相关的业务逻辑 |
| 聊天服务 | ChatService | 管理聊天会话的创建、删除、重命名，处理消息发送与AI回复，管理聊天历史记录和会话列表 |
| 文件服务 | FileService | 控制文件的上传、下载、删除、重命名、移动等操作，处理文件内容获取和元数据管理的业务逻辑 |
| 文件夹服务 | FolderService | 处理文件夹的创建、删除、重命名、查询等操作，管理文件夹树结构和层次关系的业务逻辑 |
| RAG客户端服务 | RagClientService | 控制与外部RAG服务的通信，处理向量存储构建、文档检索、智能问答等RAG相关业务逻辑 |
| 向量存储事件监听器 | VectorStoreEventListener | 监听和处理向量存储相关事件，协调向量数据的构建、更新和管理流程 |
| 用户控制器 | UserController | 协调用户相关的HTTP请求处理，调用用户服务完成具体业务逻辑，管理用户会话和权限验证 |
| 聊天控制器 | ChatController | 协调聊天相关的HTTP请求处理，调用聊天服务完成会话和消息管理，处理前端交互逻辑 |
| 文件控制器 | FileController | 协调文件操作相关的HTTP请求处理，调用文件服务完成文件管理业务，处理文件上传下载流程 |
| 文件夹控制器 | FolderController | 协调文件夹操作相关的HTTP请求处理，调用文件夹服务完成目录管理，处理树形结构展示逻辑 |
| RAG控制器 | RagController | 协调RAG相关的HTTP请求处理，调用RAG客户端服务完成智能问答业务，管理向量存储操作 |

### 3.3 实体类

| 类名（中文） | 类名（英文） | 类的作用概述 |
|------------|------------|------------|
| 用户 | User | 存储用户基本信息，包括用户名、密码（加密）、用户头像地址及创建时间等。 |
| 文件 | File | 存储文件元数据，包括文件名、所属用户ID、所属文件夹ID、文件路径、文件类型及上传时间等。 |
| 文件夹 | Folder | 表示文件夹结构，存储文件夹名称、父文件夹ID、所属用户ID、创建更新时间，支持树形结构组织。 |
| 聊天会话 | ChatSession | 存储聊天会话信息，包括会话名称、所属用户ID、创建时间和更新时间。 |
| 聊天消息 | ChatMessage | 存储聊天消息记录，包括消息内容、所属会话ID、用户ID、角色（用户/助手）及创建时间。 |


## 6 部署模型

建立本组的项目的最终部署架构（需要哪些server、哪些客户机、网络连接关系如何等等），使用UML部署模型加以描述。

一般情况下，遵循B/S架构，即系统部署在云端或服务器端，用户通过手机端或者PC端加以访问。但根据你的系统的具体特征和性能要求，可酌情引入新的物理设施。
